<emu-clause id="durationformat-objects">
  <h1>DurationFormat Objects</h1>

  <emu-clause id="sec-intl-durationformat-constructor">
    <h1>The Intl.DurationFormat Constructor</h1>

    <p>The Intl.DurationFormat constructor:</p>
    <ul>
      <li>is <dfn>%Intl.DurationFormat%</dfn>.</li>
      <li>is the initial value of the *"DurationFormat"* property of the Intl object.</li>
    </ul>

    <p>Behaviour common to all service constructor properties of the Intl object is specified in <emu-xref href="#sec-internal-slots"></emu-xref>.</p>

    <emu-clause id="sec-Intl.DurationFormat">
      <h1>Intl.DurationFormat ( [ _locales_ [ , _options_ ] ] )</h1>

      <p>When the `Intl.DurationFormat` function is called with optional arguments _locales_ and _options_, the following steps are taken:</p>

      <emu-alg>
        1. If NewTarget is *undefined*, throw a *TypeError* exception.
        1. Let _durationFormat_ be ? OrdinaryCreateFromConstructor(NewTarget, *"%Intl.DurationFormatPrototype%"*, ¬´ [[InitializedDurationFormat]], [[Locale]], [[NumberingSystem]], [[Style]], [[YearsOptions]], [[MonthsOptions]], [[WeeksOptions]], [[DaysOptions]], [[HoursOptions]], [[MinutesOptions]], [[SecondsOptions]], [[MillisecondsOptions]], [[MicrosecondsOptions]], [[NanosecondsOptions]], [[HourMinuteSeparator]], [[MinuteSecondSeparator]], [[FractionalDigits]] ¬ª).
        1. Let _optionsResolution_ be ? ResolveOptions(%Intl.DurationFormat%, %Intl.DurationFormat%.[[LocaleData]], _locales_, _options_).
        1. Set _options_ to _optionsResolution_.[[Options]].
        1. Let _r_ be _optionsResolution_.[[ResolvedLocale]].
        1. Set _durationFormat_.[[Locale]] to _r_.[[Locale]].
        1. Let _resolvedLocaleData_ be _r_.[[LocaleData]].
        1. Let _digitalFormat_ be _resolvedLocaleData_.[[DigitalFormat]].
        1. Set _durationFormat_.[[HourMinuteSeparator]] to _digitalFormat_.[[HourMinuteSeparator]].
        1. Set _durationFormat_.[[MinuteSecondSeparator]] to _digitalFormat_.[[MinuteSecondSeparator]].
        1. Set _durationFormat_.[[NumberingSystem]] to _r_.[[nu]].
        1. Let _style_ be ? GetOption(_options_, *"style"*, ~string~, ¬´ *"long"*, *"short"*, *"narrow"*, *"digital"* ¬ª, *"short"*).
        1. Set _durationFormat_.[[Style]] to _style_.
        1. Let _prevStyle_ be the empty String.
        1. For each row of <emu-xref href="#table-durationformat"></emu-xref>, except the header row, in table order, do
          1. Let _slot_ be the Internal Slot value of the current row.
          1. Let _unit_ be the Unit value of the current row.
          1. Let _styles_ be the Styles value of the current row.
          1. Let _digitalBase_ be the Digital Default value of the current row.
          1. Let _unitOptions_ be ? GetDurationUnitOptions(_unit_, _options_, _style_, _styles_, _digitalBase_, _prevStyle_, _digitalFormat_.[[TwoDigitHours]]).
          1. Set the value of _durationFormat_'s internal slot whose name is _slot_ to _unitOptions_.
          1. If _unit_ is one of *"hours"*, *"minutes"*, *"seconds"*, *"milliseconds"*, or *"microseconds"*, then
            1. Set _prevStyle_ to _unitOptions_.[[Style]].
        1. Set _durationFormat_.[[FractionalDigits]] to ? GetNumberOption(_options_, *"fractionalDigits"*, 0, 9, *undefined*).
        1. Return _durationFormat_.
      </emu-alg>
      <emu-table id="table-durationformat">
        <emu-caption>Internal slots and property names of DurationFormat instances</emu-caption>
        <table class="real-table">
          <thead>
            <tr>
              <th>Internal Slot</th>
              <th>Unit</th>
              <th>Styles</th>
              <th>Digital Default</th>
            </tr>
          </thead>
          <tr>
            <td>[[YearsOptions]]</td>
            <td>*"years"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"* ¬ª</td>
            <td>*"short"*</td>
          </tr>
          <tr>
            <td>[[MonthsOptions]]</td>
            <td>*"months"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"* ¬ª</td>
            <td>*"short"*</td>
          </tr>
          <tr>
            <td>[[WeeksOptions]]</td>
            <td>*"weeks"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"* ¬ª</td>
            <td>*"short"*</td>
          </tr>
          <tr>
            <td>[[DaysOptions]]</td>
            <td>*"days"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"* ¬ª</td>
            <td>*"short"*</td>
          </tr>
          <tr>
            <td>[[HoursOptions]]</td>
            <td>*"hours"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"*, *"2-digit"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
          <tr>
            <td>[[MinutesOptions]]</td>
            <td>*"minutes"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"*, *"2-digit"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
          <tr>
            <td>[[SecondsOptions]]</td>
            <td>*"seconds"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"*, *"2-digit"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
          <tr>
            <td>[[MillisecondsOptions]]</td>
            <td>*"milliseconds"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
          <tr>
            <td>[[MicrosecondsOptions]]</td>
            <td>*"microseconds"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
          <tr>
            <td>[[NanosecondsOptions]]</td>
            <td>*"nanoseconds"*</td>
            <td>¬´ *"long"*, *"short"*, *"narrow"*, *"numeric"* ¬ª</td>
            <td>*"numeric"*</td>
          </tr>
        </table>
      </emu-table>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-properties-of-intl-durationformat-constructor">
    <h1>Properties of the Intl.DurationFormat Constructor</h1>

    <p>The Intl.DurationFormat constructor:</p>
    <ul>
      <li>has a [[Prototype]] internal slot whose value is %Function.prototype%.</li>
      <li>has the following properties:</li>
    </ul>

    <emu-clause id="sec-Intl.DurationFormat.prototype">
      <h1>Intl.DurationFormat.prototype</h1>

      <p>The value of `Intl.DurationFormat.prototype` is %Intl.DurationFormat.prototype%.</p>

      <p>This property has the attributes { [[Writable]]: *false*, [[Enumerable]]: *false*, [[Configurable]]: *false* }.</p>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat.supportedLocalesOf">
      <h1>Intl.DurationFormat.supportedLocalesOf ( _locales_ [ , _options_ ] )</h1>

      <p>When the `supportedLocalesOf` method is called with arguments _locales_ and _options_, the following steps are taken:</p>

      <emu-alg>
        1. Let _availableLocales_ be %Intl.DurationFormat%.[[AvailableLocales]].
        1. Let _requestedLocales_ be ? CanonicalizeLocaleList(_locales_).
        1. Return ? FilterLocales(_availableLocales_, _requestedLocales_, _options_).
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat-internal-slots">
      <h1>Internal slots</h1>

      <p>The value of the [[AvailableLocales]] internal slot is implementation defined within the constraints described in <emu-xref href="#sec-internal-slots"></emu-xref>.</p>

      <p>The value of the [[RelevantExtensionKeys]] internal slot is ¬´ *"nu"* ¬ª.</p>

      <p>The value of the [[ResolutionOptionDescriptors]] internal slot is ¬´ { [[Key]]: *"nu"*, [[Property]]: *"numberingSystem"* } ¬ª.</p>

      <p>The value of the [[LocaleData]] internal slot is implementation-defined within the constraints described in <emu-xref href="#sec-internal-slots"></emu-xref> and the following additional constraints for all locale values _locale_:</p>

      <ul>
        <li>[[LocaleData]].[[&lt;_locale_>]] must be a Record with fields [[nu]] and [[DigitalFormat]].</li>
        <li>[[LocaleData]].[[&lt;_locale_>]].[[nu]] must be a List as specified in <emu-xref href="#sec-intl.numberformat-internal-slots"></emu-xref> and must not include the values *"native"*, *"traditio"*, or *"finance"*.</li>
        <li>[[LocaleData]].[[&lt;_locale_>]].[[DigitalFormat]] must be a Record with keys corresponding to each numbering system available for _locale_. Each value associated with one of those keys must be a Record containing the following fields:
          <ul>
            <li>[[HourMinuteSeparator]] must be a String value that is the appropriate separator between hours and minutes for that combination of locale and numbering system when using style *"numeric"* or *"2-digit"*.</li>
            <li>[[MinuteSecondSeparator]] must be a String value that is the appropriate separator between minutes and seconds for that combination of locale and numbering system when using style *"numeric"* or *"2-digit"*.</li>
            <li>[[TwoDigitHours]] must be a Boolean value indicating whether hours are always displayed using two digits when using style *"numeric"*.</li>
          </ul>
        </li>
      </ul>

      <emu-note>It is recommended that implementations use the locale data provided by the Common Locale Data Repository (available at <a href="http://cldr.unicode.org/">http://cldr.unicode.org/</a>).</emu-note>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-properties-of-intl-durationformat-prototype-object">
    <h1>Properties of the Intl.DurationFormat Prototype Object</h1>

    <p>The <dfn>Intl.DurationFormat prototype object</dfn>:</p>
    <ul>
      <li>is <dfn>%Intl.DurationFormat.prototype%</dfn>.</li>
      <li>is an ordinary object.</li>
      <li>is not an Intl.DurationFormat instance and does not have an [[InitializedDurationFormat]] internal slot or any of the other internal slots of Intl.DurationFormat instance objects.</li>
      <li>has a [[Prototype]] internal slot whose value is %Object.prototype%.</li>
    </ul>

    <emu-clause id="sec-Intl.DurationFormat.prototype.constructor">
      <h1>Intl.DurationFormat.prototype.constructor</h1>

      <p>The initial value of `Intl.DurationFormat.prototype.constructor` is the intrinsic object %Intl.DurationFormat%.</p>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat.prototype.resolvedOptions">
      <h1>Intl.DurationFormat.prototype.resolvedOptions ( )</h1>

      <p>This function provides access to the locale and options computed during initialization of the object.</p>

      <emu-alg>
        1. Let _df_ be the *this* value.
        1. Perform ? RequireInternalSlot(_df_, [[InitializedDurationFormat]]).
        1. Let _options_ be OrdinaryObjectCreate(%Object.prototype%).
        1. For each row of <emu-xref href="#table-durationformat-resolvedoptions-properties"></emu-xref>, except the header row, in table order, do
          1. Let _p_ be the Property value of the current row.
          1. Let _v_ be the value of _df_'s internal slot whose name is the Internal Slot value of the current row.
          1. If _v_ is not *undefined*, then
            1. If there is a Conversion value in the current row, let _conversion_ be that value; else let _conversion_ be ~empty~.
            1. If _conversion_ is ~number~, then
              1. Set _v_ to ùîΩ(_v_).
            1. Else if _conversion_ is not ~empty~, then
              1. Assert: _conversion_ is ~style+display~ and _v_ is a Duration Unit Options Record.
              1. NOTE: _v_.[[Style]] will be represented with a property named _p_ (a plural Temporal unit), then _v_.[[Display]] will be represented with a property whose name suffixes _p_ with *"Display"*.
              1. Let _style_ be _v_.[[Style]].
              1. If _style_ is *"fractional"*, then
                1. Assert: IsFractionalSecondUnitName(_p_) is *true*.
                1. Set _style_ to *"numeric"*.
              1. Perform ! CreateDataPropertyOrThrow(_options_, _p_, _style_).
              1. Set _p_ to the string-concatenation of _p_ and *"Display"*.
              1. Set _v_ to _v_.[[Display]].
            1. Perform ! CreateDataPropertyOrThrow(_options_, _p_, _v_).
        1. Return _options_.
      </emu-alg>

      <emu-table id="table-durationformat-resolvedoptions-properties">
        <emu-caption>Resolved Options of DurationFormat Instances</emu-caption>
        <table class="real-table">
          <thead>
            <tr>
              <th>Internal Slot</th>
              <th>Property</th>
              <th>Conversion</th>
            </tr>
          </thead>
          <tr>
            <td>[[Locale]]</td>
            <td>*"locale"*</td>
            <td></td>
          </tr>
          <tr>
            <td>[[NumberingSystem]]</td>
            <td>*"numberingSystem"*</td>
            <td></td>
          </tr>
          <tr>
            <td>[[Style]]</td>
            <td>*"style"*</td>
            <td></td>
          </tr>
          <tr>
            <td>[[YearsOptions]]</td>
            <td>*"years"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[MonthsOptions]]</td>
            <td>*"months"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[WeeksOptions]]</td>
            <td>*"weeks"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[DaysOptions]]</td>
            <td>*"days"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[HoursOptions]]</td>
            <td>*"hours"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[MinutesOptions]]</td>
            <td>*"minutes"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[SecondsOptions]]</td>
            <td>*"seconds"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[MillisecondsOptions]]</td>
            <td>*"milliseconds"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[MicrosecondsOptions]]</td>
            <td>*"microseconds"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[NanosecondsOptions]]</td>
            <td>*"nanoseconds"*</td>
            <td>~style+display~</td>
          </tr>
          <tr>
            <td>[[FractionalDigits]]</td>
            <td>*"fractionalDigits"*</td>
            <td>~number~</td>
          </tr>
        </table>
      </emu-table>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat.prototype.format">
      <h1>Intl.DurationFormat.prototype.format ( _durationLike_ )</h1>

      <p>When the `format` method is called with an argument _durationLike_, the following steps are taken:</p>

      <emu-alg>
        1. Let _df_ be the *this* value.
        1. Perform ? RequireInternalSlot(_df_, [[InitializedDurationFormat]]).
        1. Let _duration_ be ? ToTemporalDuration(_durationLike_).
        1. Let _parts_ be PartitionDurationFormatPattern(_df_, _duration_).
        1. Let _result_ be the empty String.
        1. For each Record { [[Type]], [[Value]], [[Unit]] } _part_ in _parts_, do
          1. Set _result_ to the string-concatenation of _result_ and _part_.[[Value]].
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat.prototype.formatToParts">
      <h1>Intl.DurationFormat.prototype.formatToParts ( _durationLike_ )</h1>

      <p>When the `formatToParts` method is called with an argument _durationLike_, the following steps are taken:</p>

      <emu-alg>
        1. Let _df_ be the *this* value.
        1. Perform ? RequireInternalSlot(_df_, [[InitializedDurationFormat]]).
        1. Let _duration_ be ? ToTemporalDuration(_durationLike_).
        1. Let _parts_ be PartitionDurationFormatPattern(_df_, _duration_).
        1. Let _result_ be ! ArrayCreate(0).
        1. Let _n_ be 0.
        1. For each Record { [[Type]], [[Value]], [[Unit]] } _part_ in _parts_, do
          1. Let _obj_ be OrdinaryObjectCreate(%Object.prototype%).
          1. Perform ! CreateDataPropertyOrThrow(_obj_, *"type"*, _part_.[[Type]]).
          1. Perform ! CreateDataPropertyOrThrow(_obj_, *"value"*, _part_.[[Value]]).
          1. If _part_.[[Unit]] is not ~empty~, perform ! CreateDataPropertyOrThrow(_obj_, *"unit"*, _part_.[[Unit]]).
          1. Perform ! CreateDataPropertyOrThrow(_result_, ! ToString(_n_), _obj_).
          1. Set _n_ to _n_ + 1.
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-Intl.DurationFormat.prototype-%symbol.tostringtag%">
      <h1>Intl.DurationFormat.prototype [ %Symbol.toStringTag% ]</h1>

      <p>The initial value of the %Symbol.toStringTag% property is the String value *"Intl.DurationFormat"*.</p>
      <p>This property has the attributes { [[Writable]]: *false*, [[Enumerable]]: *false*, [[Configurable]]: *true* }.</p>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-properties-of-intl-durationformat-instances">
    <h1>Properties of Intl.DurationFormat Instances</h1>

    <p>Intl.DurationFormat instances inherit properties from %Intl.DurationFormat.prototype%.</p>
    <p>Intl.DurationFormat instances have an [[InitializedDurationFormat]] internal slot.</p>
    <p>Intl.DurationFormat instances also have several internal slots that are computed by <emu-xref href="#sec-intl-durationformat-constructor" title></emu-xref>:</p>

    <ul>
      <li>[[Locale]] is a String value with the language tag of the locale whose localization is used for formatting.</li>
      <li>[[NumberingSystem]] is a String value representing the <a href="https://unicode.org/reports/tr35/#UnicodeNumberSystemIdentifier">Unicode Number System Identifier</a> used for formatting.</li>
      <li>[[Style]] is one of the String values *"long"*, *"short"*, *"narrow"*, or *"digital"* identifying the duration formatting style used.</li>
      <li>[[YearsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Years]] field.</li>
      <li>[[MonthsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Months]] field.</li>
      <li>[[WeeksOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Weeks]] field.</li>
      <li>[[DaysOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Days]] field.</li>
      <li>[[HoursOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Hours]] field.</li>
      <li>[[MinutesOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Minutes]] field.</li>
      <li>[[SecondsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Seconds]] field.</li>
      <li>[[MillisecondsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Milliseconds]] field.</li>
      <li>[[MicrosecondsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Microseconds]] field.</li>
      <li>[[NanosecondsOptions]] is a Duration Unit Options Record identifying the formatting style and display criteria for a Duration Record's [[Nanoseconds]] field.</li>
      <li>[[HourMinuteSeparator]] is a String value identifying the separator to be used between hours and minutes when both fields are displayed and both fields are formatted using numeric styles.</li>
      <li>[[MinuteSecondSeparator]] is a String value identifying the separator to be used between minutes and seconds when both fields are displayed and both fields are formatted using numeric styles.</li>
      <li>[[FractionalDigits]] is either *undefined* or a non-negative integer identifying the number of fractional digits to be used with numeric styles.</li>
    </ul>
  </emu-clause>

  <emu-clause id="sec-intl-durationformat-abstracts">
    <h1>Abstract Operations for DurationFormat Objects</h1>

    <emu-clause id="sec-getdurationunitoptions" type="abstract operation">
      <h1>
        GetDurationUnitOptions (
          _unit_: a String,
          _options_: an Object,
          _baseStyle_: a String,
          _stylesList_: a List of Strings,
          _digitalBase_: a String,
          _prevStyle_: a String,
          _twoDigitHours_: a Boolean,
        ): either a normal completion containing a Duration Unit Options Record, or a throw completion
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It extracts the relevant options for any given _unit_ from an Object and returns them as a Record.</dd>
      </dl>

      <emu-alg>
        1. Let _style_ be ? GetOption(_options_, _unit_, ~string~, _stylesList_, *undefined*).
        1. Let _displayDefault_ be *"always"*.
        1. If _style_ is *undefined*, then
          1. If _baseStyle_ is *"digital"*, then
            1. Set _style_ to _digitalBase_.
            1. If _unit_ is not one of *"hours"*, *"minutes"*, or *"seconds"*, set _displayDefault_ to *"auto"*.
          1. Else if _prevStyle_ is one of *"fractional"*, *"numeric"* or *"2-digit"*, then
            1. Set _style_ to *"numeric"*.
            1. If _unit_ is not *"minutes"* or *"seconds"*, set _displayDefault_ to *"auto"*.
          1. Else,
            1. Set _style_ to _baseStyle_.
            1. Set _displayDefault_ to *"auto"*.
        1. If _style_ is *"numeric"* and IsFractionalSecondUnitName(_unit_) is *true*, then
          1. Set _style_ to *"fractional"*.
          1. Set _displayDefault_ to *"auto"*.
        1. Let _displayField_ be the string-concatenation of _unit_ and *"Display"*.
        1. Let _display_ be ? GetOption(_options_, _displayField_, ~string~, ¬´ *"auto"*, *"always"* ¬ª, _displayDefault_).
        1. Perform ? ValidateDurationUnitStyle(_unit_, _style_, _display_, _prevStyle_).
        1. If _unit_ is *"hours"* and _twoDigitHours_ is *true*, set _style_ to *"2-digit"*.
        1. If _unit_ is *"minutes"* or *"seconds"* and _prevStyle_ is *"numeric"* or *"2-digit"*, set _style_ to *"2-digit"*.
        1. Return the Duration Unit Options Record { [[Style]]: _style_, [[Display]]: _display_ }.
      </emu-alg>

      <emu-clause id="sec-durationformat-unit-options-record">
        <h1>Duration Unit Options Records</h1>

        <p>Each <dfn id="durationformat-unit-options-record">Duration Unit Options Record</dfn> has the fields defined in <emu-xref href="#table-durationformat-unit-options-record"></emu-xref>.</p>
        <emu-table id="table-durationformat-unit-options-record">
          <emu-caption>Duration Unit Options Record</emu-caption>
          <table class="real-table">
            <thead>
              <tr>
                <th>Field Name</th>
                <th>Value Type</th>
              </tr>
            </thead>
            <tr>
              <td>[[Style]]</td>
              <td>a String from the Styles column of <emu-xref href="#table-durationformat"></emu-xref></td>
            </tr>
            <tr>
              <td>[[Display]]</td>
              <td>*"auto"* or *"always"*</td>
            </tr>
          </table>
        </emu-table>
      </emu-clause>

      <emu-clause id="sec-validatedurationunitstyle" type="abstract operation">
        <h1>
          ValidateDurationUnitStyle (
            _unit_: a String,
            _style_: a String,
            _display_: a String,
            _prevStyle_: a String,
          ): either a normal completion containing ~unused~ or a throw completion
        </h1>
        <dl class="header">
        </dl>
        <emu-alg>
          1. If _display_ is *"always"* and _style_ is *"fractional"*, throw a *RangeError* exception.
          1. If _prevStyle_ is *"fractional"* and _style_ is not *"fractional"*, throw a *RangeError* exception.
          1. If _prevStyle_ is *"numeric"* or *"2-digit"* and _style_ is not one of *"fractional"*, *"numeric"* or *"2-digit"*, throw a *RangeError* exception.
          1. Return ~unused~.
        </emu-alg>
        <emu-note>_unit_ is not referenced in the preceding algorithm, but it is recommended that implementations use it when constructing the message of a thrown exception.</emu-note>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-computefractionaldigits" oldids="sec-addfractionaldigits" type="abstract operation">
      <h1>
        ComputeFractionalDigits (
          _durationFormat_: a DurationFormat Object,
          _duration_: a Temporal.Duration,
        ): a mathematical value
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It computes the sum of all values in _durationFormat_ units with *"fractional"* style, expressed as a fraction of the smallest unit of _durationFormat_ that does not use *"fractional"* style.</dd>
      </dl>

      <emu-alg>
        1. Let _result_ be 0.
        1. Let _exponent_ be 3.
        1. For each row of <emu-xref href="#table-partition-duration-format-pattern"></emu-xref>, except the header row, in table order, do
          1. Let _unitOptions_ be the value of _durationFormat_'s internal slot whose name is the "Formatter Internal Slot" value of the current row.
          1. If _unitOptions_.[[Style]] is *"fractional"*, then
            1. Let _unit_ be the Unit value of the current row.
            1. Assert: IsFractionalSecondUnitName(_unit_) is *true*.
            1. Let _value_ be the value of _duration_'s internal slot whose name is the "Duration Internal Slot" value of the current row.
            1. Set _result_ to _result_ + (_value_ / 10<sup>_exponent_</sup>).
            1. Set _exponent_ to _exponent_ + 3.
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-nextunitfractional" type="abstract operation">
      <h1>
        NextUnitFractional (
          _durationFormat_: a DurationFormat Object,
          _unit_: a String,
        ): a Boolean
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It returns *true* if the next smallest unit uses the *"fractional"* style.</dd>
      </dl>

      <emu-alg>
        1. If _unit_ is *"seconds"* and _durationFormat_.[[MillisecondsOptions]].[[Style]] is *"fractional"*, return *true*.
        1. If _unit_ is *"milliseconds"* and _durationFormat_.[[MicrosecondsOptions]].[[Style]] is *"fractional"*, return *true*.
        1. If _unit_ is *"microseconds"* and _durationFormat_.[[NanosecondsOptions]].[[Style]] is *"fractional"*, return *true*.
        1. Return *false*.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-formatnumerichours" type="abstract operation">
      <h1>
        FormatNumericHours (
          _durationFormat_: a DurationFormat object,
          _hoursValue_: an integer,
          _signDisplayed_: a Boolean,
        ): a List of Records
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>_hoursValue_ is an integer indicating a number of hours. It creates the parts for _hoursValue_ according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>

      <emu-alg>
        1. Let _result_ be a new empty List.
        1. Let _hoursStyle_ be _durationFormat_.[[HoursOptions]].[[Style]].
        1. Assert: _hoursStyle_ is *"numeric"* or _hoursStyle_ is *"2-digit"*.
        1. Let _nfOpts_ be OrdinaryObjectCreate(*null*).
        1. Let _numberingSystem_ be _durationFormat_.[[NumberingSystem]].
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"numberingSystem"*, _numberingSystem_).
        1. If _hoursStyle_ is *"2-digit"*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumIntegerDigits"*, *2*<sub>ùîΩ</sub>).
        1. If _signDisplayed_ is *false*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"signDisplay"*, *"never"*).
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"useGrouping"*, *false*).
        1. Let _nf_ be ! Construct(%Intl.NumberFormat%, ¬´ _durationFormat_.[[Locale]], _nfOpts_ ¬ª).
        1. Let _hoursParts_ be PartitionNumberPattern(_nf_, _hoursValue_).
        1. For each Record { [[Type]], [[Value]] } _part_ of _hoursParts_, do
          1. Append the Record { [[Type]]: _part_.[[Type]], [[Value]]: _part_.[[Value]], [[Unit]]: *"hour"* } to _result_.
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-formatnumericminutes" type="abstract operation">
      <h1>
        FormatNumericMinutes (
          _durationFormat_: a DurationFormat Object,
          _minutesValue_: an integer,
          _hoursDisplayed_: a Boolean,
          _signDisplayed_: a Boolean,
        ): a List of Records
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>_minutesValue_ is an integer indicating a number of minutes. It creates the parts for _minutesValue_ according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>

      <emu-alg>
        1. Let _result_ be a new empty List.
        1. If _hoursDisplayed_ is *true*, then
          1. Let _separator_ be _durationFormat_.[[HourMinuteSeparator]].
          1. Append the Record { [[Type]]: *"literal"*, [[Value]]: _separator_, [[Unit]]: ~empty~ } to _result_.
        1. Let _minutesStyle_ be _durationFormat_.[[MinutesOptions]].[[Style]].
        1. Assert: _minutesStyle_ is *"numeric"* or _minutesStyle_ is *"2-digit"*.
        1. Let _nfOpts_ be OrdinaryObjectCreate(*null*).
        1. Let _numberingSystem_ be _durationFormat_.[[NumberingSystem]].
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"numberingSystem"*, _numberingSystem_).
        1. If _minutesStyle_ is *"2-digit"*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumIntegerDigits"*, *2*<sub>ùîΩ</sub>).
        1. If _signDisplayed_ is *false*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"signDisplay"*, *"never"*).
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"useGrouping"*, *false*).
        1. Let _nf_ be ! Construct(%Intl.NumberFormat%, ¬´ _durationFormat_.[[Locale]], _nfOpts_ ¬ª).
        1. Let _minutesParts_ be PartitionNumberPattern(_nf_, _minutesValue_).
        1. For each Record { [[Type]], [[Value]] } _part_ of _minutesParts_, do
          1. Append the Record { [[Type]]: _part_.[[Type]], [[Value]]: _part_.[[Value]], [[Unit]]: *"minute"* } to _result_.
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-formatnumericseconds" type="abstract operation">
      <h1>
        FormatNumericSeconds (
          _durationFormat_: a DurationFormat Object,
          _secondsValue_: a mathematical value,
          _minutesDisplayed_: a Boolean,
          _signDisplayed_: a Boolean,
        ): a List of Records
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>_secondsValue_ is a mathematical value indicating a number of seconds. It creates the parts for _secondsValue_ according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>

      <emu-alg>
        1. Let _result_ be a new empty List.
        1. If _minutesDisplayed_ is *true*, then
          1. Let _separator_ be _durationFormat_.[[MinuteSecondSeparator]].
          1. Append the Record { [[Type]]: *"literal"*, [[Value]]: _separator_, [[Unit]]: ~empty~ } to _result_.
        1. Let _secondsStyle_ be _durationFormat_.[[SecondsOptions]].[[Style]].
        1. Assert: _secondsStyle_ is *"numeric"* or _secondsStyle_ is *"2-digit"*.
        1. Let _nfOpts_ be OrdinaryObjectCreate(*null*).
        1. Let _numberingSystem_ be _durationFormat_.[[NumberingSystem]].
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"numberingSystem"*, _numberingSystem_).
        1. If _secondsStyle_ is *"2-digit"*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumIntegerDigits"*, *2*<sub>ùîΩ</sub>).
        1. If _signDisplayed_ is *false*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"signDisplay"*, *"never"*).
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"useGrouping"*, *false*).
        1. Let _fractionDigits_ be _durationFormat_.[[FractionalDigits]].
        1. If _fractionDigits_ is *undefined*, then
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"maximumFractionDigits"*, *9*<sub>ùîΩ</sub>).
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumFractionDigits"*, *+0*<sub>ùîΩ</sub>).
        1. Else,
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"maximumFractionDigits"*, _fractionDigits_).
          1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumFractionDigits"*, _fractionDigits_).
        1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"roundingMode"*, *"trunc"*).
        1. Let _nf_ be ! Construct(%Intl.NumberFormat%, ¬´ _durationFormat_.[[Locale]], _nfOpts_ ¬ª).
        1. Let _secondsParts_ be PartitionNumberPattern(_nf_, _secondsValue_).
        1. For each Record { [[Type]], [[Value]] } _part_ of _secondsParts_, do
          1. Append the Record { [[Type]]: _part_.[[Type]], [[Value]]: _part_.[[Value]], [[Unit]]: *"second"* } to _result_.
        1. Return _result_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-formatnumericunits" type="abstract operation">
      <h1>
        FormatNumericUnits (
          _durationFormat_: a DurationFormat Object,
          _duration_: a Temporal.Duration,
          _firstNumericUnit_: a String,
          _signDisplayed_: a Boolean,
        ): a List of Records
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It creates the parts representing the elements of _duration_ that use *"numeric"* or *"2-digit"* style according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>

      <emu-alg>
        1. Assert: _firstNumericUnit_ is *"hours"*, *"minutes"*, or *"seconds"*.
        1. Let _numericPartsList_ be a new empty List.
        1. Let _hoursValue_ be _duration_.[[Hours]].
        1. Let _hoursDisplay_ be _durationFormat_.[[HoursOptions]].[[Display]].
        1. Let _minutesValue_ be _duration_.[[Minutes]].
        1. Let _minutesDisplay_ be _durationFormat_.[[MinutesOptions]].[[Display]].
        1. Let _secondsValue_ be _duration_.[[Seconds]].
        1. If _duration_.[[Milliseconds]] is not 0 or _duration_.[[Microseconds]] is not 0 or _duration_.[[Nanoseconds]] is not 0, then
          1. Set _secondsValue_ to _secondsValue_ + ComputeFractionalDigits(_durationFormat_, _duration_).
        1. Let _secondsDisplay_ be _durationFormat_.[[SecondsOptions]].[[Display]].
        1. Let _hoursFormatted_ be *false*.
        1. If _firstNumericUnit_ is *"hours"*, then
          1. If _hoursValue_ is not 0 or _hoursDisplay_ is *"always"*, then
            1. Set _hoursFormatted_ to *true*.
        1. If _secondsValue_ is not 0 or _secondsDisplay_ is *"always"*, then
          1. Let _secondsFormatted_ be *true*.
        1. Else,
          1. Let _secondsFormatted_ be *false*.
        1. Let _minutesFormatted_ be *false*.
        1. If _firstNumericUnit_ is *"hours"* or _firstNumericUnit_ is *"minutes"*, then
          1. If _hoursFormatted_ is *true* and _secondsFormatted_ is *true*, then
            1. Set _minutesFormatted_ to *true*.
          1. Else if _minutesValue_ is not 0 or _minutesDisplay_ is *"always"*, then
            1. Set _minutesFormatted_ to *true*.
        1. If _hoursFormatted_ is *true*, then
          1. If _signDisplayed_ is *true*, then
            1. If _hoursValue_ is 0 and DurationSign(_duration_) is -1, then
              1. Set _hoursValue_ to ~negative-zero~.
          1. Let _hoursParts_ be FormatNumericHours(_durationFormat_, _hoursValue_, _signDisplayed_).
          1. Set _numericPartsList_ to the list-concatenation of _numericPartsList_ and _hoursParts_.
          1. Set _signDisplayed_ to *false*.
        1. If _minutesFormatted_ is *true*, then
          1. If _signDisplayed_ is *true*, then
            1. If _minutesValue_ is 0 and DurationSign(_duration_) is -1, then
              1. Set _minutesValue_ to ~negative-zero~.
          1. Let _minutesParts_ be FormatNumericMinutes(_durationFormat_, _minutesValue_, _hoursFormatted_, _signDisplayed_).
          1. Set _numericPartsList_ to the list-concatenation of _numericPartsList_ and _minutesParts_.
          1. Set _signDisplayed_ to *false*.
        1. If _secondsFormatted_ is *true*, then
          1. Let _secondsParts_ be FormatNumericSeconds(_durationFormat_, _secondsValue_, _minutesFormatted_, _signDisplayed_).
          1. Set _numericPartsList_ to the list-concatenation of _numericPartsList_ and _secondsParts_.
        1. Return _numericPartsList_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-isfractionalsecondunitname" type="abstract operation">
      <h1>
        IsFractionalSecondUnitName (
          _unit_: a String,
        ): a Boolean
      </h1>
      <dl class="header">
      </dl>
      <emu-alg>
        1. If _unit_ is one of *"milliseconds"*, *"microseconds"*, or *"nanoseconds"*, return *true*.
        1. Return *false*.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-listformatparts" type="abstract operation">
      <h1>
        ListFormatParts (
          _durationFormat_: a DurationFormat Object,
          _partitionedPartsList_: a List of Lists of Records,
        ): a List
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It creates a List corresponding to the parts within the Lists in _partitionedPartsList_ according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>
      <emu-alg>
        1. Let _lfOpts_ be OrdinaryObjectCreate(*null*).
        1. Perform ! CreateDataPropertyOrThrow(_lfOpts_, *"type"*, *"unit"*).
        1. Let _listStyle_ be _durationFormat_.[[Style]].
        1. If _listStyle_ is *"digital"*, then
          1. Set _listStyle_ to *"short"*.
        1. Perform ! CreateDataPropertyOrThrow(_lfOpts_, *"style"*, _listStyle_).
        1. Let _lf_ be ! Construct(%Intl.ListFormat%, ¬´ _durationFormat_.[[Locale]], _lfOpts_ ¬ª).
        1. Let _strings_ be a new empty List.
        1. For each element _parts_ of _partitionedPartsList_, do
          1. Let _string_ be the empty String.
          1. For each Record { [[Type]], [[Value]], [[Unit]] } _part_ in _parts_, do
            1. Set _string_ to the string-concatenation of _string_ and _part_.[[Value]].
          1. Append _string_ to _strings_.
        1. Let _formattedPartsList_ be CreatePartsFromList(_lf_, _strings_).
        1. Let _partitionedPartsIndex_ be 0.
        1. Let _partitionedLength_ be the number of elements in _partitionedPartsList_.
        1. Let _flattenedPartsList_ be a new empty List.
        1. For each Record { [[Type]], [[Value]] } _listPart_ in _formattedPartsList_, do
          1. If _listPart_.[[Type]] is *"element"*, then
            1. Assert: _partitionedPartsIndex_ &lt; _partitionedLength_.
            1. Let _parts_ be _partitionedPartsList_[_partitionedPartsIndex_].
            1. For each Record { [[Type]], [[Value]], [[Unit]] } _part_ in _parts_, do
              1. Append _part_ to _flattenedPartsList_.
            1. Set _partitionedPartsIndex_ to _partitionedPartsIndex_ + 1.
          1. Else,
            1. Assert: _listPart_.[[Type]] is *"literal"*.
            1. Append the Record { [[Type]]: *"literal"*, [[Value]]: _listPart_.[[Value]], [[Unit]]: ~empty~ } to _flattenedPartsList_.
        1. Return _flattenedPartsList_.
      </emu-alg>
    </emu-clause>

    <emu-clause id="sec-partitiondurationformatpattern" type="abstract operation">
      <h1>
        PartitionDurationFormatPattern (
          _durationFormat_: a DurationFormat,
          _duration_: a Temporal.Duration,
        ): a List
      </h1>
      <dl class="header">
        <dt>description</dt>
        <dd>It creates the corresponding parts for _duration_ according to the effective locale and the formatting options of _durationFormat_.</dd>
      </dl>

      <emu-alg>
        1. Let _result_ be a new empty List.
        1. Let _signDisplayed_ be *true*.
        1. Let _numericUnitFound_ be *false*.
        1. While _numericUnitFound_ is *false*, repeat for each row in <emu-xref href="#table-partition-duration-format-pattern"></emu-xref> in table order, except the header row:
          1. Let _value_ be the value of _duration_'s internal slot whose name is the "Duration Internal Slot" value of the current row.
          1. Let _unitOptions_ be the value of _durationFormat_'s internal slot whose name is the "Formatter Internal Slot" value of the current row.
          1. Let _style_ be _unitOptions_.[[Style]].
          1. Let _display_ be _unitOptions_.[[Display]].
          1. Let _unit_ be the Unit value of the current row.
          1. Let _numberFormatUnit_ be the NumberFormat Unit value of the current row.
          1. If _style_ is *"numeric"* or *"2-digit"*, then
            1. Let _numericPartsList_ be FormatNumericUnits(_durationFormat_, _duration_, _unit_, _signDisplayed_).
            1. If _numericPartsList_ is not empty, append _numericPartsList_ to _result_.
            1. Set _numericUnitFound_ to *true*.
          1. Else,
            1. Let _nfOpts_ be OrdinaryObjectCreate(*null*).
            1. If NextUnitFractional(_durationFormat_, _unit_) is *true*, then
              1. Set _value_ to _value_ + ComputeFractionalDigits(_durationFormat_, _duration_).
              1. Let _fractionDigits_ be _durationFormat_.[[FractionalDigits]].
              1. If _fractionDigits_ is *undefined*, then
                1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"maximumFractionDigits"*, *9*<sub>ùîΩ</sub>).
                1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumFractionDigits"*, *+0*<sub>ùîΩ</sub>).
              1. Else,
                1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"maximumFractionDigits"*, _fractionDigits_).
                1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"minimumFractionDigits"*, _fractionDigits_).
              1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"roundingMode"*, *"trunc"*).
              1. Set _numericUnitFound_ to *true*.
            1. If _display_ is *"always"* or _value_ is not 0, then
              1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"numberingSystem"*, _durationFormat_.[[NumberingSystem]]).
              1. If _signDisplayed_ is *true*, then
                1. Set _signDisplayed_ to *false*.
                1. If _value_ is 0 and DurationSign(_duration_) is -1, set _value_ to ~negative-zero~.
              1. Else,
                1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"signDisplay"*, *"never"*).
              1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"style"*, *"unit"*).
              1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"unit"*, _numberFormatUnit_).
              1. Perform ! CreateDataPropertyOrThrow(_nfOpts_, *"unitDisplay"*, _style_).
              1. Let _nf_ be ! Construct(%Intl.NumberFormat%, ¬´ _durationFormat_.[[Locale]], _nfOpts_ ¬ª).
              1. Let _parts_ be PartitionNumberPattern(_nf_, _value_).
              1. Let _list_ be a new empty List.
              1. For each Record { [[Type]], [[Value]] } _part_ of _parts_, do
                1. Append the Record { [[Type]]: _part_.[[Type]], [[Value]]: _part_.[[Value]], [[Unit]]: _numberFormatUnit_ } to _list_.
              1. Append _list_ to _result_.
        1. Return ListFormatParts(_durationFormat_, _result_).
      </emu-alg>

      <emu-table id="table-partition-duration-format-pattern">
        <emu-caption>DurationFormat instance internal slots and properties relevant to PartitionDurationFormatPattern</emu-caption>
        <table class="real-table">
          <thead>
            <tr>
              <th>Duration Internal Slot</th>
              <th>Formatter Internal Slot</th>
              <th>Unit</th>
              <th>NumberFormat Unit</th>
            </tr>
          </thead>
          <tr>
            <td>[[Years]]</td>
            <td>[[YearsOptions]]</td>
            <td>*"years"*</td>
            <td>*"year"*</td>
          </tr>
          <tr>
            <td>[[Months]]</td>
            <td>[[MonthsOptions]]</td>
            <td>*"months"*</td>
            <td>*"month"*</td>
          </tr>
          <tr>
            <td>[[Weeks]]</td>
            <td>[[WeeksOptions]]</td>
            <td>*"weeks"*</td>
            <td>*"week"*</td>
          </tr>
          <tr>
            <td>[[Days]]</td>
            <td>[[DaysOptions]]</td>
            <td>*"days"*</td>
            <td>*"day"*</td>
          </tr>
          <tr>
            <td>[[Hours]]</td>
            <td>[[HoursOptions]]</td>
            <td>*"hours"*</td>
            <td>*"hour"*</td>
          </tr>
          <tr>
            <td>[[Minutes]]</td>
            <td>[[MinutesOptions]]</td>
            <td>*"minutes"*</td>
            <td>*"minute"*</td>
          </tr>
          <tr>
            <td>[[Seconds]]</td>
            <td>[[SecondsOptions]]</td>
            <td>*"seconds"*</td>
            <td>*"second"*</td>
          </tr>
          <tr>
            <td>[[Milliseconds]]</td>
            <td>[[MillisecondsOptions]]</td>
            <td>*"milliseconds"*</td>
            <td>*"millisecond"*</td>
          </tr>
          <tr>
            <td>[[Microseconds]]</td>
            <td>[[MicrosecondsOptions]]</td>
            <td>*"microseconds"*</td>
            <td>*"microsecond"*</td>
          </tr>
          <tr>
            <td>[[Nanoseconds]]</td>
            <td>[[NanosecondsOptions]]</td>
            <td>*"nanoseconds"*</td>
            <td>*"nanosecond"*</td>
          </tr>
        </table>
      </emu-table>
    </emu-clause>
  </emu-clause>
</emu-clause>
